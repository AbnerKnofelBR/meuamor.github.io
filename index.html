
<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Nossa Hist√≥ria</title>
<style>
  :root{
    --bg:#12010f;
    --text:#1a0a12;
    --white:#ffffff;
    --muted:#f7e9f0;

    --rose-50:#fff1f5;
    --rose-100:#ffe4e9;
    --rose-200:#fecdd3;
    --rose-300:#fda4af;
    --rose-400:#fb7185;
    --rose-500:#f43f5e;
    --rose-600:#e11d48;
    --rose-700:#be123c;
    --rose-800:#9f1239;

    --pink-400:#f472b6;
    --pink-500:#ec4899;
    --pink-600:#db2777;

    --space:#070915;

    --content-max: 28rem;

    --shadow-1: 0 10px 30px rgba(244,63,94,.25);
    --shadow-2: 0 6px 16px rgba(0,0,0,.3);

    --focus: 0 0 0 3px rgba(244,63,94,.5);
  }

  *{ box-sizing: border-box; }
  html, body{
    height:100%;
    margin:0;
    background: var(--rose-50);
    color:#2a0e19;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    -webkit-text-size-adjust: 100%;
    text-size-adjust: 100%;
    scroll-behavior: smooth;
  }

  /* Scroll container uses body */
  body{
    scroll-snap-type: y mandatory;
    overscroll-behavior-y: contain;
  }

  /* Sections */
  section.section{
    position: relative;
    min-height: 100svh; /* mobile friendly viewport */
    padding: clamp(16px, 3vw, 24px);
    display: grid;
    grid-template-rows: 1fr auto;
    align-items: center;
    justify-items: center;
    scroll-snap-align: start;
    scroll-snap-stop: always;
    isolation: isolate;
  }

  .content{
    z-index: 2;
    width: min(100%, var(--content-max));
    text-align: center;
    margin-inline: auto;
  }

  h1{
    margin: 0 0 .5rem 0;
    font-size: clamp(2rem, 6.5vw, 3rem);
    line-height: 1.1;
    color: var(--rose-700);
    text-shadow: 0 1px 0 #fff6, 0 8px 30px rgba(244,63,94,.2);
  }
  h2{
    margin: 0 0 .75rem 0;
    font-size: clamp(1.25rem, 4.5vw, 1.75rem);
    color: var(--rose-700);
  }
  p{
    margin: 0 auto 1rem auto;
    color: #4d1725;
    font-size: clamp(1rem, 3.8vw, 1.125rem);
    line-height: 1.5;
  }

  /* Romantic backgrounds per section (subtle gradients) */
  #s1{ background: radial-gradient(120% 100% at 50% 0%, #fff7fa 0%, #ffe5ec 50%, #ffd1dc 100%); }
  #s2{ background: radial-gradient(140% 100% at 50% 0%, #fff5f8 0%, #ffe1ea 50%, #fecdd6 100%); }
  #s3{ background: radial-gradient(160% 120% at 50% 0%, #0b0c1a 0%, #0a0a18 40%, #070915 100%); color:#f8f8ff; }
  #s4{ background: radial-gradient(140% 100% at 50% 0%, #fff5f8 0%, #ffe1ea 50%, #fecdd6 100%); }
  #s5{ background: radial-gradient(140% 100% at 50% 0%, #fff5f7 0%, #ffe0ea 50%, #fecbd6 100%); }

  /* Floating hearts overlay for every section (SVG elements) */
  .hearts{
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 1;
    overflow: hidden;
  }
  /* SVG heart element */
  svg.heart{
    position: absolute;
    bottom: -12vh;
    left: var(--left, 50%);
    width: var(--size, 14px);
    height: var(--size, 14px);
    transform: translateY(0) rotate(-25deg) scale(var(--scale, 1));
    transform-origin: center;
    animation: rise var(--dur, 10s) linear infinite var(--delay, 0s);
    will-change: transform, opacity;
    opacity: 0.9;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,.2)) hue-rotate(var(--hue, 0deg));
  }

  @keyframes rise{
    0%{ transform: translateY(10vh) translateX(0) rotate(-25deg) scale(var(--scale,1)); opacity: 0; }
    8%{ opacity: .9; }
    50%{ transform: translateY(-40vh) translateX(var(--drift, 15px)) rotate(-15deg) scale(var(--scale,1)); }
    100%{ transform: translateY(-120vh) translateX(calc(var(--drift, 15px) * -1)) rotate(-5deg) scale(var(--scale,1)); opacity: 0; }
  }

  /* Next arrow button (SVG) */
  .next{
    z-index: 2;
    align-self: end;
    margin-bottom: calc(env(safe-area-inset-bottom, 0px) + 10px);
    border: none;
    background: rgba(255,255,255,.65);
    color: #7a0f28;
    width: 52px;
    height: 52px;
    border-radius: 999px;
    display: grid;
    place-items: center;
    box-shadow: var(--shadow-2);
    cursor: pointer;
    transition: transform .15s ease, background .2s ease;
  }
  .next:hover{ transform: translateY(2px); }
  .next:active{ transform: translateY(4px) scale(.98); }
  .next:focus-visible{ outline: none; box-shadow: var(--focus); }

  .next svg{ width: 26px; height: 26px; }

  /* Section 2: Carousel */
  .carousel-wrap{
    position: relative;
    width: 100%;
    max-width: 100svw;
    z-index: 2;
  }
  .carousel{
    display: grid;
    grid-auto-flow: column;
    grid-auto-columns: 85%;
    gap: 12px;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    padding: 6px 8px;
    border-radius: 16px;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }
  .carousel::-webkit-scrollbar{ display: none; }
  .slide{
    position: relative;
    aspect-ratio: 4/3;
    background: #fff;
    border-radius: 14px;
    overflow: hidden;
    scroll-snap-align: center;
    box-shadow: 0 10px 30px rgba(244,63,94,.2);
  }
  .slide img{
    width: 100%;
    height: 100%;
    object-fit: cover;
    background: #ffe6ee;
    display: block;
  }
  .nav-btn{
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    z-index: 3;
    width: 44px; height: 44px;
    border: none; border-radius: 999px;
    display: grid; place-items: center;
    background: rgba(255,255,255,.8);
    box-shadow: var(--shadow-2);
    cursor: pointer;
  }
  .nav-btn:focus-visible{ outline: none; box-shadow: var(--focus); }
  .nav-prev{ left: 6px; }
  .nav-next{ right: 6px; }

  .dots{
    display: flex;
    justify-content: center;
    gap: 6px;
    margin-top: 10px;
  }
  .dot{
    width: 8px; height: 8px;
    border-radius: 999px;
    background: #f4a3b8;
    opacity: .6;
    transition: transform .2s ease, opacity .2s ease, background .2s ease;
  }
  .dot.active{ transform: scale(1.5); opacity: 1; background: var(--rose-600); }

  /* Section 3: Space + solar system */
  .space{
    position: absolute;
    inset: 0;
    z-index: 0;
    overflow: hidden;
  }
  .stars-canvas{
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    display: block;
  }

  .solar{
    position: relative;
    width: min(80vw, 360px);
    height: min(80vw, 360px);
    margin: 8px auto 16px;
  }
  .sun{
    position: absolute;
    inset: 50% auto auto 50%;
    width: 90px; height: 90px;
    transform: translate(-50%, -50%);
    background: radial-gradient(circle at 30% 30%, #fff4cc 0 35%, #ffd36e 60%, #ff9d00 100%);
    border-radius: 50%;
    box-shadow: 0 0 40px 10px rgba(255,200,80,.55), 0 0 80px 20px rgba(255,150,50,.35), inset 0 0 8px rgba(255,255,255,.45);
  }
  .orbit{
    position: absolute;
    inset: 50% auto auto 50%;
    width: 240px; height: 240px;
    transform: translate(-50%, -50%);
    border: 1px dashed rgba(255,255,255,.25);
    border-radius: 50%;
    animation: orbit-rot 16s linear infinite;
  }
  @keyframes orbit-rot{ to{ transform: translate(-50%, -50%) rotate(360deg); } }
  .earth{
    position: absolute;
    top: 50%; left: 0;
    transform: translate(-50%, -50%);
    width: 32px; height: 32px;
    background: radial-gradient(circle at 30% 30%, #b3f3ff 0 40%, #2aa6ff 60%, #0560b5 100%);
    border-radius: 50%;
    box-shadow: 0 0 8px rgba(80,160,255,.6);
  }

  .elapsed{
    width: min(95%, 760px);
    margin: 14px auto 8px;
    display: grid;
    grid-template-columns: repeat(3, minmax(0,1fr));
    gap: 8px;
  }
  .elapsed .cell{
    background: rgba(255,255,255,.08);
    color: #fff;
    border: 1px solid rgba(255,255,255,.12);
    border-radius: 12px;
    padding: 10px 8px;
    text-align: center;
    backdrop-filter: blur(4px);
  }
  .cell .num{
    font-size: clamp(1.25rem, 6.5vw, 1.75rem);
    font-weight: 700;
    display: block;
  }
  .cell .lab{
    font-size: .8rem;
    opacity: .85;
  }

  /* Section 4: Earth & Moon + phase */
  .earth-moon{
    position: relative;
    width: min(80vw, 360px);
    height: min(80vw, 360px);
    margin: 10px auto 12px;
  }
  .earth-4{
    position: absolute;
    inset: 50% auto auto 50%;
    width: 80px; height: 80px;
    transform: translate(-50%, -50%);
    background: radial-gradient(circle at 30% 30%, #b3f3ff 0 40%, #2aa6ff 60%, #0560b5 100%);
    border-radius: 50%;
    box-shadow: 0 0 10px rgba(80,160,255,.6);
  }
  .orbit-4{
    position: absolute;
    inset: 50% auto auto 50%;
    width: 220px; height: 220px;
    transform: translate(-50%, -50%);
    border: 1px dashed rgba(244,63,94,.35);
    border-radius: 50%;
    animation: orbit-rot 8s linear infinite;
  }
  .moon-4{
    position: absolute;
    top: 50%; left: 0;
    transform: translate(-50%, -50%);
    width: 22px; height: 22px;
    background: radial-gradient(circle at 30% 30%, #f5f5f5 0 40%, #dddddd 60%, #bcbcbc 100%);
    border-radius: 50%;
    box-shadow: 0 0 6px rgba(0,0,0,.15);
  }
  .phase-wrap{
    display: grid;
    place-items: center;
    gap: 8px;
  }
  .phase-canvas{
    width: 160px; height: 160px;
    border-radius: 999px;
    background: radial-gradient(circle at 50% 40%, #e9e9e9 0 50%, #d8d8d8 60%, #cfcfcf 100%);
    box-shadow: inset 0 0 12px rgba(0,0,0,.15), 0 6px 20px rgba(0,0,0,.12);
  }
  .phase-label{
    font-weight: 600;
    color: var(--rose-700);
  }
  .phase-sub{
    color: #6b2535;
    font-size: .9rem;
    opacity: .9;
  }

  /* Section 5: Question */
  .choices{
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    width: min(92%, 420px);
    margin: 8px auto 0;
  }
  .btn{
    border: none;
    border-radius: 14px;
    padding: 14px 16px;
    font-size: clamp(1rem, 4.5vw, 1.125rem);
    font-weight: 700;
    cursor: pointer;
    box-shadow: var(--shadow-1);
    transition: transform .15s ease, box-shadow .2s ease, background .2s ease, color .2s ease;
  }
  .btn:focus-visible{ outline: none; box-shadow: var(--focus); }
  .btn-primary{ background: linear-gradient(180deg, var(--rose-500), var(--rose-600)); color: #fff; }
  .btn-primary:active{ transform: translateY(2px); }
  .btn-ghost{ background: #fff; color: var(--rose-700); border: 1px solid #f4a3b8; }
  .btn-ghost:active{ transform: translateY(2px); }

  /* SIM "new page" view */
  .sim-view{
    position: fixed;
    inset: 0;
    z-index: 50;
    display: none;
    background: radial-gradient(140% 100% at 50% 0%, #fff5f7 0%, #ffe0ea 50%, #fecbd6 100%);
  }
  .sim-view.active{ display: grid; grid-template-rows: 1fr auto; }
  .sim-wrap{
    z-index: 2;
    width: min(100%, var(--content-max));
    margin: auto;
    text-align: center;
    padding: 24px;
  }
  .timer{
    width: min(95%, 680px);
    margin: 12px auto 8px;
    display: grid;
    grid-template-columns: repeat(4, minmax(0,1fr));
    gap: 8px;
  }
  .timer .cell{
    background: #ffffffcc;
    color: #7a0f28;
    border: 1px solid #ffd1dd;
    border-radius: 12px;
    padding: 12px 8px;
    text-align: center;
  }
  .sim-close{
    position: absolute;
    top: calc(env(safe-area-inset-top, 0px) + 10px);
    right: 10px;
    width: 42px; height: 42px;
    border-radius: 999px;
    border: none;
    background: rgba(255,255,255,.85);
    box-shadow: var(--shadow-2);
    cursor: pointer;
  }
  .sim-close:focus-visible{ outline: none; box-shadow: var(--focus); }

  /* "N√£o" overlay */
  .overlay{
    position: fixed;
    inset: 0;
    z-index: 60;
    display: none;
    background: rgba(0,0,0,.35);
    backdrop-filter: blur(2px);
  }
  .overlay.active{ display: grid; place-items: center; }
  .overlay-card{
    width: min(92%, 420px);
    border-radius: 16px;
    background: #fff;
    padding: 18px;
    box-shadow: var(--shadow-2);
    text-align: center;
    position: relative;
  }
  .overlay .close-x{
    position: absolute;
    top: 8px; right: 8px;
    width: 36px; height: 36px;
    border-radius: 999px; border: none;
    background: #ffe5ed;
    color: var(--rose-700);
    cursor: pointer;
  }
  .overlay .close-x:focus-visible{ outline: none; box-shadow: var(--focus); }
  .overlay .later-link{
    margin-top: 10px;
    display: none;
  }
  .overlay .later-link.show{ display: inline-block; }

  /* Audio toggle + toast */
  .audio-toggle{
    position: fixed;
    right: 12px;
    bottom: calc(env(safe-area-inset-bottom, 0px) + 12px);
    z-index: 70;
    width: 54px; height: 54px;
    border: none; border-radius: 999px;
    display: grid; place-items: center;
    background: #ffffffdd;
    box-shadow: var(--shadow-2);
    cursor: pointer;
  }
  .audio-toggle:focus-visible{ outline: none; box-shadow: var(--focus); }
  .toast{
    position: fixed;
    left: 12px;
    bottom: calc(env(safe-area-inset-bottom, 0px) + 16px);
    z-index: 70;
    background: #1a0e14;
    color: #fff;
    border: 1px solid #f4a3b8;
    border-radius: 999px;
    padding: 10px 12px;
    font-size: .95rem;
    box-shadow: var(--shadow-2);
    display: none;
  }
  .toast.show{ display: inline-block; }

  /* Utility muted text on dark bg */
  #s3 .muted{ color: #d7c7cf; opacity: .85; }

  /* Safe area padding for footers if needed */
  .pad-bottom{
    padding-bottom: calc(env(safe-area-inset-bottom, 0px));
  }
</style>
</head>
<body>

<!-- Global SVG defs for vector hearts (symbol + gradient) -->
<svg width="0" height="0" style="position:absolute; overflow:hidden" aria-hidden="true" focusable="false">
  <defs>
    <!-- Reusable heart path -->
    <symbol id="heartSymbol" viewBox="0 0 32 29.6">
      <!-- Cl√°ssico cora√ß√£o suave -->
      <path d="M23.6,0c-3.1,0-5.7,2.1-7.6,4.8C14.1,2.1,11.5,0,8.4,0C3.7,0,0,3.7,0,8.4C0,17.6,16,29.6,16,29.6
               S32,17.6,32,8.4C32,3.7,28.3,0,23.6,0z"/>
    </symbol>

    <!-- Romantic gradient fill for hearts -->
    <linearGradient id="heartGrad" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#ffe1ef"/>
      <stop offset="45%" stop-color="#f98aa6"/>
      <stop offset="100%" stop-color="#f43f5e"/>
    </linearGradient>
  </defs>
</svg>

<!-- Background audio (usu√°rio deve substituir o caminho se desejar) -->
<!-- Troque o arquivo de m√∫sica aqui: ./musica.mp3 -->
<audio id="bgAudio" src="NX Zero - Cedo Ou Tarde.mp3" autoplay loop playsinline></audio>

<!-- Floating audio toggle and autoplay toast -->
<button id="audioToggle" class="audio-toggle" aria-label="Mutar √°udio">
  <svg id="icon-sound-on" xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="#7a0f28" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
    <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
    <path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>
  </svg>
  <svg id="icon-sound-off" style="display:none" xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="#7a0f28" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
    <line x1="23" y1="1" x2="17" y2="7"></line>
    <line x1="17" y1="1" x2="23" y2="7"></line>
  </svg>
</button>
<div id="autoplayToast" class="toast" role="status" aria-live="polite">Toque para ativar o som</div>

<!-- Section 1 -->
<section id="s1" class="section" aria-label="Abertura">
  <div class="hearts" aria-hidden="true"></div>

  <div class="content">
    <h1>Nossa Hist√≥ria - A & J</h1>
    <p>Uma jornada de amor, mem√≥rias e planos para o futuro ‚Äî feita para ser vivida de cora√ß√£o aberto. Que esse presente, venha ser uma mem√≥ria eterna para voc√™! <br> N√£o se esque√ßa de apertar play na m√∫sica no canto inferior direito.  </p>
  </div>

  <button class="next" aria-label="Ir para a se√ß√£o de fotos" data-go="#s2">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true"><path fill="#7a0f28" d="M12 16a1 1 0 0 1-.7-.29l-6-6a1 1 0 0 1 1.4-1.42L12 13.59l5.3-5.3a1 1 0 0 1 1.4 1.42l-6 6A1 1 0 0 1 12 16z"/></svg>
  </button>
</section>

<!-- Section 2: Carousel -->
<section id="s2" class="section" aria-label="Carrossel de Fotos">
  <div class="hearts" aria-hidden="true"></div>

  <div class="content">
    <h2>Nossas lembran√ßas</h2>
    <p>Deslize para o lado e reviva alguns dos nossos momentos favoritos.</p>

    <div class="carousel-wrap" aria-roledescription="carrossel" aria-label="Fotos do casal">
      <button class="nav-btn nav-prev" aria-label="Foto anterior">
        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"><path fill="#7a0f28" d="m14 7l-5 5l5 5V7z"/></svg>
      </button>

      <div id="carousel" class="carousel" tabindex="0">
        <!-- Substitua as imagens abaixo por suas fotos em ./fotos/N.jpg -->
        <figure class="slide">
          <img src="ft1.jpg" alt="Foto 1" onerror="this.src='https://placehold.co/800x600/FFE1EA/7A0F28?text=Foto+1';">
        </figure>
        <figure class="slide">
          <img src="ft2.jpg" alt="Foto 2" onerror="this.src='https://placehold.co/800x600/FFE1EA/7A0F28?text=Foto+2';">
        </figure>
        <figure class="slide">
          <img src="ft3.jpg" alt="Foto 3" onerror="this.src='https://placehold.co/800x600/FFE1EA/7A0F28?text=Foto+3';">
        </figure>
      </div>

      <button class="nav-btn nav-next" aria-label="Pr√≥xima foto">
        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"><path fill="#7a0f28" d="m10 17l5-5l-5-5v10z"/></svg>
      </button>

      <div id="dots" class="dots" aria-hidden="true"></div>
    </div>
  </div>

  <button class="next" aria-label="Ir para o sistema solar" data-go="#s3">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="#7a0f28" d="M12 16a1 1 0 0 1-.7-.29l-6-6a1 1 0 0 1 1.4-1.42L12 13.59l5.3-5.3a1 1 0 0 1 1.4 1.42l-6 6A1 1 0 0 1 12 16z"/></svg>
  </button>
</section>

<!-- Section 3: Space + Solar System + Elapsed Timer -->
<section id="s3" class="section" aria-label="Sistema Solar e Cron√¥metro">
  <div class="space">
    <canvas id="stars" class="stars-canvas" aria-hidden="true"></canvas>
  </div>
  <div class="hearts" aria-hidden="true"></div>

  <div class="content">
    <h2>Nosso universo</h2>
    <p class="muted">Cada volta ao redor do sol carrega nossas hist√≥rias. Veja quanto tempo j√° vivemos desde 18/01/2025.</p>

    <div class="solar" aria-hidden="true">
      <div class="sun"></div>
      <div class="orbit">
        <div class="earth"></div>
      </div>
    </div>

    <div class="elapsed" aria-live="polite">
      <div class="cell"><span id="y" class="num">0</span><span class="lab">anos</span></div>
      <div class="cell"><span id="mo" class="num">0</span><span class="lab">meses</span></div>
      <div class="cell"><span id="d" class="num">0</span><span class="lab">dias</span></div>
      <div class="cell"><span id="h" class="num">0</span><span class="lab">horas</span></div>
      <div class="cell"><span id="mi" class="num">0</span><span class="lab">minutos</span></div>
      <div class="cell"><span id="s" class="num">0</span><span class="lab">segundos</span></div>
    </div>
  </div>

  <button class="next" aria-label="Ir para a fase da lua" data-go="#s4">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="#f3e9fb" d="M12 16a1 1 0 0 1-.7-.29l-6-6a1 1 0 0 1 1.4-1.42L12 13.59l5.3-5.3a1 1 0 0 1 1.4 1.42l-6 6A1 1 0 0 1 12 16z"/></svg>
  </button>
</section>

<!-- Section 4: Earth & Moon + Phase -->
<section id="s4" class="section" aria-label="Terra e Lua">
  <div class="hearts" aria-hidden="true"></div>

  <div class="content">
    <h2>Debaixo da mesma lua</h2>
    <p>Na noite em que nos conhecemos 18/01/2025, como estava a lua? Veja a fase e um pequeno retrato dela.</p>

    <div class="earth-moon" aria-hidden="true">
      <div class="earth-4"></div>
      <div class="orbit-4">
        <div class="moon-4"></div>
      </div>
    </div>

    <div class="phase-wrap">
      <canvas id="moonCanvas" class="phase-canvas" width="160" height="160" aria-label="Visual da fase lunar"></canvas>
      <div id="phaseText" class="phase-label">Calculando fase...</div>
      <div id="phaseSub" class="phase-sub"></div>
    </div>
  </div>

  <button class="next" aria-label="Ir para a pergunta final" data-go="#s5">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="#7a0f28" d="M12 16a1 1 0 0 1-.7-.29l-6-6a1 1 0 0 1 1.4-1.42L12 13.59l5.3-5.3a1 1 0 0 1 1.4 1.42l-6 6A1 1 0 0 1 12 16z"/></svg>
  </button>
</section>

<!-- Section 5: Question -->
<section id="s5" class="section" aria-label="Pergunta final">
  <div class="hearts" aria-hidden="true"></div>

  <div class="content">
    <h2>Voc√™ quer continuar essa hist√≥ria comigo?</h2>
    <p>Prometo cuidar do nosso universo, dia ap√≥s dia.</p>

    <div class="choices">
      <button id="btnYes" class="btn btn-primary" aria-label="Sim">Sim</button>
      <button id="btnNo" class="btn btn-ghost" aria-label="N√£o">N√£o</button>
    </div>
  </div>
</section>

<!-- SIM View (full screen within same HTML) -->
<section id="simView" class="sim-view" aria-label="Contagem para o nosso pr√≥ximo passo" aria-modal="true" role="dialog">
  <div class="hearts" aria-hidden="true"></div>
  <button class="sim-close" aria-label="Fechar contagem" id="simClose">
    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"><path fill="#7a0f28" d="M18.3 5.71a1 1 0 0 0-1.41 0L12 10.59L7.11 5.7A1 1 0 0 0 5.7 7.11L10.59 12l-4.9 4.89a1 1 0 1 0 1.41 1.41L12 13.41l4.89 4.9a1 1 0 1 0 1.41-1.41L13.41 12l4.9-4.89a1 1 0 0 0-.01-1.4Z"/></svg>
  </button>

  <div class="sim-wrap">
    <h1>Contagem para o nosso pr√≥ximo passo</h1>
    <p>Obrigado por dizer sim. Que cada segundo nos leve mais perto de um novo cap√≠tulo.</p>

    <div class="timer" aria-live="polite">
      <div class="cell"><span id="td" class="num">0</span><span class="lab">dias</span></div>
      <div class="cell"><span id="th" class="num">0</span><span class="lab">horas</span></div>
      <div class="cell"><span id="tmin" class="num">0</span><span class="lab">minutos</span></div>
      <div class="cell"><span id="ts" class="num">0</span><span class="lab">segundos</span></div>
    </div>

    <div id="finalMsg" class="phase-label" style="margin-top:8px;"></div>
  </div>
</section>

<!-- "N√£o" overlay -->
<div id="noOverlay" class="overlay" role="dialog" aria-modal="true" aria-label="Obrigado">
  <div class="overlay-card">
    <button class="close-x" id="noClose" aria-label="Fechar">‚úï</button>
    <h2>Obrigado por visitar</h2>
    <p>Mesmo que nossas estrelas sigam em caminhos diferentes, sou grato por este momento.</p>
    <!-- Edite o link abaixo para o seu redirecionamento -->
    <a id="laterLink" class="btn btn-ghost later-link" href="#" target="_blank" rel="noopener">Saber mais</a>
  </div>
</div>

<script>
(function(){
  'use strict';

  /* Utilities */
  const $ = (sel, ctx=document) => ctx.querySelector(sel);
  const $$ = (sel, ctx=document) => Array.from(ctx.querySelectorAll(sel));

  /* Smooth scroll for arrows */
  function setupArrows(){
    $$('.next').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const target = btn.getAttribute('data-go');
        const el = target ? $(target) : null;
        if(el) el.scrollIntoView({behavior:'smooth', block:'start'});
      });
    });
  }

  /* Hearts overlay generator using SVG elements */
  const SVG_NS = 'http://www.w3.org/2000/svg';
  function createHearts(container, count=12){
    const n = Math.min(Math.max(count, 6), 15);
    for(let i=0; i<n; i++){
      const left = (Math.random()*100).toFixed(2) + '%';
      const size = (10 + Math.random()*16).toFixed(1) + 'px'; // 10-26px
      const scale = (0.8 + Math.random()*0.9).toFixed(2);
      const dur = (9 + Math.random()*12).toFixed(2) + 's';    // 9-21s
      const delay = (-Math.random()*(parseFloat(dur))).toFixed(2) + 's'; // negative for stagger
      const drift = ((Math.random()<.5?-1:1) * (8 + Math.random()*18)).toFixed(1) + 'px';
      const hue = (Math.random()*30 - 15).toFixed(1) + 'deg'; // subtle -15..+15

      const svg = document.createElementNS(SVG_NS, 'svg');
      svg.setAttribute('class', 'heart');
      svg.setAttribute('viewBox', '0 0 32 29.6');
      svg.style.setProperty('--left', left);
      svg.style.setProperty('--size', size);
      svg.style.setProperty('--scale', scale);
      svg.style.setProperty('--dur', dur);
      svg.style.setProperty('--delay', delay);
      svg.style.setProperty('--drift', drift);
      svg.style.setProperty('--hue', hue);

      const use = document.createElementNS(SVG_NS, 'use');
      // Prefer href (SVG2), fallback xlink:href for older Safari
      use.setAttributeNS('http://www.w3.org/1999/xlink', 'xlink:href', '#heartSymbol');
      use.setAttribute('href', '#heartSymbol');
      use.setAttribute('fill', 'url(#heartGrad)');

      svg.appendChild(use);
      container.appendChild(svg);
    }
  }

  function setupHearts(){
    $$('.hearts').forEach(h => createHearts(h, 12));
  }

  /* Audio: autoplay handling + floating toggle */
  const audio = $('#bgAudio');
  const audioToggle = $('#audioToggle');
  const iconOn = $('#icon-sound-on');
  const iconOff = $('#icon-sound-off');
  const toast = $('#autoplayToast');

  function updateAudioUI(){
    const muted = audio.muted || audio.paused;
    if(muted){
      iconOn.style.display = 'none';
      iconOff.style.display = 'block';
      audioToggle.setAttribute('aria-label','Ativar √°udio');
    }else{
      iconOn.style.display = 'block';
      iconOff.style.display = 'none';
      audioToggle.setAttribute('aria-label','Mutar √°udio');
    }
  }

  async function tryPlay(){
    try{
      await audio.play();
      toast.classList.remove('show');
    }catch(e){
      // Autoplay blocked
      toast.classList.add('show');
    }finally{
      updateAudioUI();
    }
  }

  function setupAudio(){
    if(audio){
      tryPlay();
    }
    audioToggle.addEventListener('click', async ()=>{
      if(audio.paused){
        await audio.play().catch(()=>{});
        audio.muted = false;
      }else{
        // toggle mute state
        audio.muted = !audio.muted;
        if(!audio.muted){
          await audio.play().catch(()=>{});
        }
      }
      toast.classList.remove('show');
      updateAudioUI();
    });

    // Start audio on first user interaction if blocked
    const firstUserStart = async ()=>{
      await audio.play().catch(()=>{});
      audio.muted = false;
      toast.classList.remove('show');
      updateAudioUI();
      window.removeEventListener('pointerdown', firstUserStart);
    };
    window.addEventListener('pointerdown', firstUserStart, { once:true });
  }

  /* Section 2: Carousel */
  function setupCarousel(){
    const track = $('#carousel');
    const slides = $$('.slide', track);
    const dots = $('#dots');
    if(!track || slides.length===0 || !dots) return;

    // Create dots
    slides.forEach((_,i)=>{
      const d = document.createElement('span');
      d.className = 'dot' + (i===0?' active':'');
      dots.appendChild(d);
    });

    function activeIndex(){
      const slideWidth = slides[0].getBoundingClientRect().width + 12; // gap
      const idx = Math.round(track.scrollLeft / slideWidth);
      return Math.min(Math.max(idx, 0), slides.length-1);
    }

    function updateDots(){
      const idx = activeIndex();
      $$('.dot', dots).forEach((el,i)=> el.classList.toggle('active', i===idx));
    }

    function go(delta){
      const slideWidth = slides[0].getBoundingClientRect().width + 12;
      track.scrollBy({ left: delta*slideWidth, behavior: 'smooth' });
    }

    $('.nav-prev').addEventListener('click', ()=>go(-1));
    $('.nav-next').addEventListener('click', ()=>go(1));
    track.addEventListener('scroll', ()=>{ requestAnimationFrame(updateDots); }, { passive:true });

    // Keyboard support on focus
    track.addEventListener('keydown', (e)=>{
      if(e.key === 'ArrowLeft'){ e.preventDefault(); go(-1); }
      if(e.key === 'ArrowRight'){ e.preventDefault(); go(1); }
    });
  }

  /* Section 3: Stars canvas + elapsed timer */
  function setupStars(){
    const canvas = $('#stars');
    if(!canvas) return;
    const ctx = canvas.getContext('2d');
    let w, h, dpr, stars = [];
    let rafId = 0;
    let running = false;

    function resize(){
      dpr = Math.min(window.devicePixelRatio || 1, 2);
      w = canvas.clientWidth;
      h = canvas.clientHeight;
      canvas.width = Math.floor(w*dpr);
      canvas.height = Math.floor(h*dpr);
      ctx.setTransform(dpr,0,0,dpr,0,0);
      // reinit stars
      const count = Math.floor((w*h)/15000); // density
      stars = Array.from({length: count}, ()=>({
        x: Math.random()*w,
        y: Math.random()*h,
        r: Math.random()*1.6 + 0.2,
        tw: Math.random()*Math.PI*2,
        sp: 0.002 + Math.random()*0.004
      }));
    }

    function draw(){
      ctx.clearRect(0,0,w,h);
      // background gradient
      const g = ctx.createLinearGradient(0,0,0,h);
      g.addColorStop(0,'#0b0c1a');
      g.addColorStop(1,'#070915');
      ctx.fillStyle = g;
      ctx.fillRect(0,0,w,h);

      // stars
      for(const s of stars){
        s.tw += s.sp;
        const a = 0.6 + Math.sin(s.tw)*0.4;
        ctx.globalAlpha = Math.max(0, Math.min(1, a));
        ctx.fillStyle = '#ffffff';
        ctx.beginPath();
        ctx.arc(s.x, s.y, s.r, 0, Math.PI*2);
        ctx.fill();
      }
      ctx.globalAlpha = 1;

      if(running) rafId = requestAnimationFrame(draw);
    }

    function start(){ if(!running){ running = true; rafId = requestAnimationFrame(draw); } }
    function stop(){ running = false; cancelAnimationFrame(rafId); }

    const observer = new IntersectionObserver(entries=>{
      entries.forEach(e=>{
        if(e.isIntersecting) start(); else stop();
      });
    }, { threshold: 0.1 });
    observer.observe($('#s3'));

    window.addEventListener('resize', resize);
    resize();
  }

  // Elapsed timer since 2019-03-15 00:00:00 local
  function setupElapsed(){
    const start = new Date(2025, 1, 18, 0, 0, 0); // local time
    const ids = { y:'#y', mo:'#mo', d:'#d', h:'#h', mi:'#mi', s:'#s' };
    const out = Object.fromEntries(Object.entries(ids).map(([k,sel])=>[k, $(sel)]));

    function diffYMDHMS(from, to){
      // Count years and months accurately by rolling the date
      let y=0, m=0;
      let cursor = new Date(from);
      // years
      while(true){
        const next = new Date(cursor);
        next.setFullYear(next.getFullYear()+1);
        if(next <= to){ y++; cursor = next; } else break;
      }
      // months
      while(true){
        const next = new Date(cursor);
        next.setMonth(next.getMonth()+1);
        if(next <= to){ m++; cursor = next; } else break;
      }
      // remainder
      let ms = to - cursor;
      const d = Math.floor(ms / 86400000); ms -= d*86400000;
      const h = Math.floor(ms / 3600000); ms -= h*3600000;
      const mi = Math.floor(ms / 60000); ms -= mi*60000;
      const s = Math.floor(ms / 1000);
      return { y, m, d, h, mi, s };
    }

    function tick(){
      const now = new Date();
      const t = diffYMDHMS(start, now);
      out.y.textContent = t.y;
      out.mo.textContent = t.m;
      out.d.textContent = t.d;
      out.h.textContent = t.h;
      out.mi.textContent = t.mi;
      out.s.textContent = t.s;
    }
    tick();
    setInterval(tick, 1000);
  }

  /* Section 4: Moon phase for 2019-03-15 21:00 local */
  function setupMoonPhase(){
    const canvas = $('#moonCanvas');
    if(!canvas) return;
    const ctx = canvas.getContext('2d');
    const w = canvas.width, h = canvas.height;
    const cx = w/2, cy = h/2, R = Math.min(w,h)*0.42;

    // Epoch new moon: 2000-01-06 18:14 UTC
    const epoch = new Date(Date.UTC(2000,0,6,18,14,0));
    // Target local datetime: 2019-03-15 21:00
    const target = new Date(2025, 1, 18, 21, 0, 0); // local
    const synodic = 29.530588853; // days

    const raw = (target.getTime() - epoch.getTime())/86400000;
    const ageDays = raw % synodic;
    const age = ageDays < 0 ? ageDays + synodic : ageDays;
    const k = age / synodic; // 0..1

    function phaseName(frac){
      const idx = Math.round(frac*8) % 8;
      switch(idx){
        case 0: return 'Lua Nova';
        case 1: return 'Crescente';
        case 2: return 'Quarto Crescente';
        case 3: return 'Gibosa Crescente';
        case 4: return 'Cheia';
        case 5: return 'Gibosa Minguante';
        case 6: return 'Quarto Minguante';
        case 7: return 'Minguante';
        default: return 'Desconhecida';
      }
    }

    function drawMoon(){
      ctx.clearRect(0,0,w,h);

      // Background for contrast
      ctx.fillStyle = '#ffeaf0';
      ctx.fillRect(0,0,w,h);

      // Moon dark disk (shadow outline)
      ctx.save();
      ctx.translate(cx, cy);
      ctx.fillStyle = '#111318';
      ctx.beginPath();
      ctx.arc(0,0,R,0,Math.PI*2);
      ctx.fill();

      // Lit area (approximation with two arcs)
      const phi = 2*Math.PI*k;
      const waxing = k < 0.5;
      const m = Math.abs(Math.cos(phi)); // 1 on new, 0 on full
      const shift = (waxing ? 1 : -1) * (m * R);

      // Base lit color
      ctx.fillStyle = '#f1f1f1';
      ctx.beginPath();
      // Right (or left) semicircle
      ctx.arc(0,0,R,-Math.PI/2, Math.PI/2, false);
      // Second arc with shifted center
      ctx.arc(shift,0,R,Math.PI/2, -Math.PI/2, false);
      ctx.closePath();
      ctx.fill();

      // Subtle texture shadow at edge
      const g = ctx.createRadialGradient(-R*0.15, -R*0.2, R*0.2, 0,0, R);
      g.addColorStop(0,'rgba(0,0,0,0)');
      g.addColorStop(1,'rgba(0,0,0,.25)');
      ctx.fillStyle = g;
      ctx.beginPath();
      ctx.arc(0,0,R,0,Math.PI*2);
      ctx.fill();
      ctx.restore();

      // Ring highlight
      ctx.strokeStyle = 'rgba(0,0,0,.25)';
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.arc(cx,cy,R+0.5,0,Math.PI*2);
      ctx.stroke();
    }

    drawMoon();

    $('#phaseText').textContent = phaseName(k);
    $('#phaseSub').textContent = `Idade aproximada: ${age.toFixed(1)} dias (${Math.round(k*100)}% do ciclo)`;
  }

  /* Section 5: Yes/No interactions */
  const LS_KEY = 'simEndTs';

  function addMonthsCal(d, months){
    const dt = new Date(d);
    const day = dt.getDate();
    dt.setMonth(dt.getMonth()+months);
    // Se rolou para o pr√≥ximo m√™s, voltar para o √∫ltimo dia do m√™s anterior
    if(dt.getDate() < day){
      dt.setDate(0);
    }
    return dt;
  }

  function setupYesNo(){
    const btnYes = $('#btnYes');
    const btnNo = $('#btnNo');
    const simView = $('#simView');
    const simClose = $('#simClose');
    const td = $('#td'), th = $('#th'), tmin = $('#tmin'), ts = $('#ts');
    const finalMsg = $('#finalMsg');
    const noOverlay = $('#noOverlay');
    const noClose = $('#noClose');
    const laterLink = $('#laterLink');

    let timerId = 0;

    function showSim(){
      simView.classList.add('active');
    }
    function hideSim(){
      simView.classList.remove('active');
    }

    function updateCountdown(){
      const endTs = parseInt(localStorage.getItem(LS_KEY) || '0', 10);
      if(!endTs){ td.textContent=th.textContent=tmin.textContent=ts.textContent='0'; return; }
      const now = Date.now();
      let diff = endTs - now;
      if(diff <= 0){
        clearInterval(timerId);
        td.textContent=th.textContent=tmin.textContent=ts.textContent='0';
        finalMsg.textContent = 'Chegou o grande dia!';
        return;
      }
      const d = Math.floor(diff/86400000); diff -= d*86400000;
      const h = Math.floor(diff/3600000); diff -= h*3600000;
      const m = Math.floor(diff/60000); diff -= m*60000;
      const s = Math.floor(diff/1000);
      td.textContent = d;
      th.textContent = h.toString().padStart(2,'0');
      tmin.textContent = m.toString().padStart(2,'0');
      ts.textContent = s.toString().padStart(2,'0');
      finalMsg.textContent = '';
    }

    function startTimerIfNeeded(){
      const has = localStorage.getItem(LS_KEY);
      if(has){
        showSim();
        updateCountdown();
        clearInterval(timerId);
        timerId = setInterval(updateCountdown, 1000);
      }
    }

    btnYes.addEventListener('click', ()=>{
      if(!localStorage.getItem(LS_KEY)){
        const end = addMonthsCal(new Date(), 3);
        localStorage.setItem(LS_KEY, String(end.getTime()));
      }
      startTimerIfNeeded();
    });

    simClose.addEventListener('click', ()=> hideSim());
    // Escape key to close sim view
    window.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && simView.classList.contains('active')) hideSim(); });

    // "N√£o" logic
    btnNo.addEventListener('click', ()=>{
      noOverlay.classList.add('active');
      laterLink.classList.remove('show');
      // Ap√≥s 10s, mostrar link (usu√°rio pode editar href="#" abaixo)
      setTimeout(()=>{ laterLink.classList.add('show'); }, 10000);
    });
    noClose.addEventListener('click', ()=> noOverlay.classList.remove('active'));
    noOverlay.addEventListener('click', (e)=>{ if(e.target === noOverlay) noOverlay.classList.remove('active'); });

    // Persisted timer on reload
    startTimerIfNeeded();
  }

  /* Init */
  document.addEventListener('DOMContentLoaded', ()=>{
    setupArrows();
    setupHearts();
    setupAudio();
    setupCarousel();
    setupStars();
    setupElapsed();
    setupMoonPhase();
    setupYesNo();
  });
})();
</script>


</body>
</html>


